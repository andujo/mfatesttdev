ﬂA
aC:\Users\jonathan andujo\Documents\GitHub\mfatesttdev\DatingApp.API\Controllers\AuthController.cs
	namespace 	
	DatingApp
 
. 
API 
. 
Controllers #
{ 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
AuthController 
:  !
ControllerBase" 0
{ 
private 
readonly 
IAuthRepository (
_repo) .
;. /
private 
readonly 
IConfiguration '
_config( /
;/ 0
private 
readonly 
IMapper  
_mapper! (
;( )
public 
AuthController 
( 
IAuthRepository -
repo. 2
,2 3
IConfiguration4 B
configC I
,I J
IMapperK R
mapperS Y
)Y Z
{ 	
_mapper 
= 
mapper 
; 
_config 
= 
config 
; 
_repo 
= 
repo 
; 
} 	
[ 	
HttpPost	 
( 
$str 
) 
] 
public 
async 
Task 
< 
IActionResult '
>' (
Register) 1
(1 2
[2 3
FromBody3 ;
]; <
UserForRegisterDto< N
userForRegisterDtoO a
)a b
{   	
if!! 
(!! 
!!! 

ModelState!! 
.!! 
IsValid!! #
)!!# $
return!!% +

BadRequest!!, 6
(!!6 7

ModelState!!7 A
)!!A B
;!!B C
userForRegisterDto"" 
."" 
UserName"" '
=""( )
userForRegisterDto""* <
.""< =
UserName""= E
.""E F
ToLower""F M
(""M N
)""N O
;""O P
if## 
(## 
await## 
_repo## 
.## 

UserExists## &
(##& '
userForRegisterDto##' 9
.##9 :
UserName##: B
)##B C
)##C D
return$$ 

BadRequest$$ !
($$! "
$str$$" :
)$$: ;
;$$; <
var&& 
userToCreate&& 
=&& 
_mapper&& &
.&&& '
Map&&' *
<&&* +
User&&+ /
>&&/ 0
(&&0 1
userForRegisterDto&&1 C
)&&C D
;&&D E
var(( 
createdUser(( 
=(( 
await(( #
_repo(($ )
.(() *
Register((* 2
(((2 3
userToCreate((3 ?
,((? @
userForRegisterDto((A S
.((S T
Password((T \
)((\ ]
;((] ^
var** 
userToReturn** 
=** 
_mapper** &
.**& '
Map**' *
<*** +
UserForDetailedDto**+ =
>**= >
(**> ?
createdUser**? J
)**J K
;**K L
return++ 
CreatedAtRoute++ !
(++! "
$str++" +
,+++ ,
new++- 0
{++1 2

controller++2 <
=++= >
$str++? F
,++F G
id++H J
=++K L
createdUser++M X
.++X Y
Id++Y [
}++[ \
,++\ ]
userToReturn,, 
),, 
;,, 
}-- 	
[// 	
HttpPost//	 
(// 
$str// 
)// 
]// 
public00 
async00 
Task00 
<00 
IActionResult00 '
>00' (
Login00) .
(00. /
[00/ 0
FromBody000 8
]008 9
UserForLoginDto009 H
userForLoginDto00I X
)00X Y
{11 	
if22 
(22 
!22 

ModelState22 
.22 
IsValid22 #
)22# $
return22% +

BadRequest22, 6
(226 7

ModelState227 A
)22A B
;22B C
var55 
tfa55 
=55 
new55 
TwoFactorAuthNet55 *
.55* +
TwoFactorAuth55+ 8
(558 9
)559 :
;55: ;
if66 
(66 
tfa66 
.66 

VerifyCode66 
(66 
Base3266 %
.66% &
Encode66& ,
(66, -
Encoding66- 5
.665 6
UTF8666 :
.66: ;
GetBytes66; C
(66C D
userForLoginDto66D S
.66S T
UserName66T \
)66\ ]
)66] ^
,66^ _
userForLoginDto66` o
.66o p
MfaCode66p w
)66w x
)66x y
{77 
var88 
userFromRepo88  
=88! "
await88# (
_repo88) .
.88. /
Login88/ 4
(884 5
userForLoginDto885 D
.88D E
UserName88E M
.88M N
ToLower88N U
(88U V
)88V W
,88W X
userForLoginDto88Y h
.88h i
Password88i q
)88q r
;88r s
if99 
(99 
userFromRepo99  
==99! #
null99$ (
)99( )
return:: 
Unauthorized:: '
(::' (
)::( )
;::) *
var== 
claims== 
=== 
new==  
[==  !
]==! "
{>> 
new?? 
Claim?? !
(??! "

ClaimTypes??" ,
.??, -
NameIdentifier??- ;
,??; <
userFromRepo??= I
.??I J
Id??J L
.??L M
ToString??M U
(??U V
)??V W
)??W X
,??X Y
new@@ 
Claim@@ !
(@@! "

ClaimTypes@@" ,
.@@, -
Name@@- 1
,@@1 2
userFromRepo@@3 ?
.@@? @
UserName@@@ H
)@@H I
}AA 
;AA 
varCC 
keyCC 
=CC 
newCC  
SymmetricSecurityKeyCC 2
(CC2 3
EncodingCC3 ;
.CC; <
UTF8CC< @
.DD 
GetBytesDD 
(DD 
_configDD !
.DD! "

GetSectionDD" ,
(DD, -
$strDD- @
)DD@ A
.DDA B
ValueDDB G
)DDG H
)DDH I
;DDI J
varFF 
credsFF 
=FF 
newFF 
SigningCredentialsFF  2
(FF2 3
keyFF3 6
,FF6 7
SecurityAlgorithmsFF8 J
.FFJ K
HmacSha512SignatureFFK ^
)FF^ _
;FF_ `
varHH 
tokenDescriptorHH #
=HH$ %
newHH& )#
SecurityTokenDescriptorHH* A
{II 
SubjectJJ 
=JJ 
newJJ !
ClaimsIdentityJJ" 0
(JJ0 1
claimsJJ1 7
)JJ7 8
,JJ8 9
ExpiresKK 
=KK 
DateTimeKK &
.KK& '
NowKK' *
.KK* +
AddDaysKK+ 2
(KK2 3
$numKK3 4
)KK4 5
,KK5 6
SigningCredentialsLL &
=LL' (
credsLL) .
}MM 
;MM 
varOO 
tokenHandlerOO  
=OO! "
newOO# &#
JwtSecurityTokenHandlerOO' >
(OO> ?
)OO? @
;OO@ A
varQQ 
tokenQQ 
=QQ 
tokenHandlerQQ (
.QQ( )
CreateTokenQQ) 4
(QQ4 5
tokenDescriptorQQ5 D
)QQD E
;QQE F
varRR 
userRR 
=RR 
_mapperRR "
.RR" #
MapRR# &
<RR& '
UserForListDtoRR' 5
>RR5 6
(RR6 7
userFromRepoRR7 C
)RRC D
;RRD E
returnTT 
OkTT 
(TT 
newTT 
{UU 
tokenVV 
=VV 
tokenHandlerVV (
.VV( )

WriteTokenVV) 3
(VV3 4
tokenVV4 9
)VV9 :
,VV: ;
userWW 
}XX 
)XX 
;XX 
}YY 
elseZZ 
return[[ 

BadRequest[[ !
([[! "
$str[[" 7
)[[7 8
;[[8 9
}\\ 	
}]] 
}^^ úk
cC:\Users\jonathan andujo\Documents\GitHub\mfatesttdev\DatingApp.API\Controllers\PhotosController.cs
	namespace 	
	DatingApp
 
. 
API 
. 
Controllers #
{ 
[ 
	Authorize 
] 
[ 
Route 

(
 
$str &
)& '
]' (
public 

class 
PhotosController !
:" #
ControllerBase$ 2
{ 
private 
readonly 
IDatingRepository *
_repo+ 0
;0 1
private 
readonly 
IMapper  
_mapper! (
;( )
private 
readonly 

Cloudinary #
_cloudinary$ /
;/ 0
public 
PhotosController 
(  
IDatingRepository  1
repo2 6
,6 7
IMapper8 ?
mapper@ F
,F G
IOptions 
< 
CloudinarySettings '
>' (
cloudinaryConfig) 9
)9 :
{ 	
IOptions 
< 
CloudinarySettings '
>' (
_cloudinaryConfig) :
;: ;
_cloudinaryConfig 
= 
cloudinaryConfig  0
;0 1
_mapper 
= 
mapper 
; 
_repo   
=   
repo   
;   
Account!! 
acc!! 
=!! 
new!! 
Account!! &
(!!& '
_cloudinaryConfig"" !
.""! "
Value""" '
.""' (
	CloudName""( 1
,""1 2
_cloudinaryConfig## !
.##! "
Value##" '
.##' (
ApiKey##( .
,##. /
_cloudinaryConfig$$ !
.$$! "
Value$$" '
.$$' (
	ApiSecret$$( 1
)%% 
;%% 
_cloudinary&& 
=&& 
new&& 

Cloudinary&& )
(&&) *
acc&&* -
)&&- .
;&&. /
}'' 	
[))	 

HttpGet))
 
()) 
$str)) 
,)) 
Name)) 
=))  
$str))! +
)))+ ,
])), -
public** 
async** 
Task** 
<** 
IActionResult** '
>**' (
GetPhoto**) 1
(**1 2
int**2 5
id**6 8
)**8 9
{++ 	
var,, 
photoFromRepo,, 
=,, 
await,,  %
_repo,,& +
.,,+ ,
GetPhoto,,, 4
(,,4 5
id,,5 7
),,7 8
;,,8 9
var-- 
photo-- 
=-- 
_mapper--  
.--  !
Map--! $
<--$ %
PhotoForReturnDto--% 6
>--6 7
(--7 8
photoFromRepo--8 E
)--E F
;--F G
return.. 
Ok.. 
(.. 
photo.. 
).. 
;.. 
}// 	
[11 	
HttpPost11	 
]11 
public22 
async22 
Task22 
<22 
IActionResult22 '
>22' (
AddPhotoForUser22) 8
(228 9
int229 <
userId22= C
,22C D
[33 
FromForm33 
]33 
PhotoForCreationDto33 )
photoForCreationDto33* =
)33= >
{44 	
if55 
(55 
userId55 
!=55 
int55 
.55 
Parse55 #
(55# $
User55$ (
.55( )
	FindFirst55) 2
(552 3

ClaimTypes553 =
.55= >
NameIdentifier55> L
)55L M
.55M N
Value55N S
)55S T
)55T U
return66 
Unauthorized66 #
(66# $
)66$ %
;66% &
var77 
userFromRepo77 
=77 
await77  %
_repo77& +
.77+ ,
GetUser77, 3
(773 4
userId774 :
)77: ;
;77; <
var88 
file88 
=88 
photoForCreationDto88 +
.88+ ,
File88, 0
;880 1
var99 
uploadResult99 
=99 
new99  #
ImageUploadResult99$ 5
(995 6
)996 7
;997 8
if:: 
(:: 
file:: 
.:: 
Length:: 
>:: 
$num::  
)::  !
{;; 
using<< 
(<< 
var<< 
stream<< !
=<<" #
file<<$ (
.<<( )
OpenReadStream<<) 7
(<<7 8
)<<8 9
)<<9 :
{== 
var>> 
uploadParams>> $
=>>% &
new>>' *
ImageUploadParams>>+ <
(>>< =
)>>= >
{?? 
File@@ 
=@@ 
new@@ "
FileDescription@@# 2
(@@2 3
file@@3 7
.@@7 8
Name@@8 <
,@@< =
stream@@> D
)@@D E
,@@E F
TransformationAA &
=AA' (
newAA) ,
TransformationAA- ;
(AA; <
)AA< =
.BB 
WidthBB "
(BB" #
$numBB# &
)BB& '
.BB' (
HeightBB( .
(BB. /
$numBB/ 2
)BB2 3
.BB3 4
CropBB4 8
(BB8 9
$strBB9 ?
)BB? @
.BB@ A
GravityBBA H
(BBH I
$strBBI O
)BBO P
}CC 
;CC 
uploadResultDD !
=DD" #
_cloudinaryDD$ /
.DD/ 0
UploadDD0 6
(DD6 7
uploadParamsDD7 C
)DDC D
;DDD E
}EE 
}FF 
photoForCreationDtoHH 
.HH  
UrlHH  #
=HH$ %
uploadResultHH& 2
.HH2 3
UriHH3 6
.HH6 7
ToStringHH7 ?
(HH? @
)HH@ A
;HHA B
photoForCreationDtoII 
.II  
PublicIdII  (
=II) *
uploadResultII+ 7
.II7 8
PublicIdII8 @
;II@ A
varJJ 
photoJJ 
=JJ 
_mapperJJ  
.JJ  !
MapJJ! $
<JJ$ %
PhotoJJ% *
>JJ* +
(JJ+ ,
photoForCreationDtoJJ, ?
)JJ? @
;JJ@ A
ifKK 
(KK 
!KK 
userFromRepoKK 
.KK 
PhotosKK %
.KK% &
AnyKK& )
(KK) *
uKK* +
=>KK, .
uKK/ 0
.KK0 1
IsMainKK1 7
)KK7 8
)KK8 9
photoLL 
.LL 
IsMainLL 
=LL 
trueLL #
;LL# $
userFromRepoMM 
.MM 
PhotosMM  
.MM  !
AddMM! $
(MM$ %
photoMM% *
)MM* +
;MM+ ,
ifNN 
(NN 
awaitNN 
_repoNN 
.NN 
SaveAllNN $
(NN$ %
)NN% &
)NN& '
{OO 
varPP 
photoToReturnPP !
=PP" #
_mapperPP$ +
.PP+ ,
MapPP, /
<PP/ 0
PhotoForReturnDtoPP0 A
>PPA B
(PPB C
photoPPC H
)PPH I
;PPI J
returnQQ 
CreatedAtRouteQQ %
(QQ% &
$strQQ& 0
,QQ0 1
newQQ2 5
{QQ6 7
idQQ8 :
=QQ; <
photoQQ= B
.QQB C
IdQQC E
}QQF G
,QQG H
photoToReturnQQI V
)QQV W
;QQW X
}RR 
returnSS 

BadRequestSS 
(SS 
$strSS 8
)SS8 9
;SS9 :
}TT 	
[VV 	
HttpPostVV	 
(VV 
$strVV  
)VV  !
]VV! "
publicWW 
asyncWW 
TaskWW 
<WW 
IActionResultWW '
>WW' (
SetMainPhotoWW) 5
(WW5 6
intWW6 9
userIdWW: @
,WW@ A
intWWB E
idWWF H
)WWH I
{XX 	
ifYY 
(YY 
userIdYY 
!=YY 
intYY 
.YY 
ParseYY #
(YY# $
UserYY$ (
.YY( )
	FindFirstYY) 2
(YY2 3

ClaimTypesYY3 =
.YY= >
NameIdentifierYY> L
)YYL M
.YYM N
ValueYYN S
)YYS T
)YYT U
returnZZ 
UnauthorizedZZ #
(ZZ# $
)ZZ$ %
;ZZ% &
var[[ 
user[[ 
=[[ 
await[[ 
_repo[[ #
.[[# $
GetUser[[$ +
([[+ ,
userId[[, 2
)[[2 3
;[[3 4
if\\ 
(\\ 
!\\ 
user\\ 
.\\ 
Photos\\ 
.\\ 
Any\\ !
(\\! "
p\\" #
=>\\$ &
p\\' (
.\\( )
Id\\) +
==\\, .
id\\/ 1
)\\1 2
)\\2 3
return]] 
Unauthorized]] #
(]]# $
)]]$ %
;]]% &
var^^ 
photoFromRepo^^ 
=^^  
await^^! &
_repo^^' ,
.^^, -
GetPhoto^^- 5
(^^5 6
id^^6 8
)^^8 9
;^^9 :
if__ 
(__ 
photoFromRepo__ 
.__ 
IsMain__ %
)__% &
return`` 

BadRequest`` !
(``! "
$str``" B
)``B C
;``C D
varaa 
currentMainPhotoaa !
=aa" #
awaitaa$ )
_repoaa* /
.aa/ 0
GetMainPhotoForUseraa0 C
(aaC D
userIdaaD J
)aaJ K
;aaK L
currentMainPhotobb 
.bb 
IsMainbb #
=bb$ %
falsebb& +
;bb+ ,
photoFromRepocc 
.cc 
IsMaincc !
=cc" #
truecc$ (
;cc( )
ifdd 
(dd 
awaitdd 
_repodd 
.dd 
SaveAlldd $
(dd$ %
)dd% &
)dd& '
returnee 
	NoContentee  
(ee  !
)ee! "
;ee" #
returnff 

BadRequestff 
(ff 
$strff <
)ff< =
;ff= >
}gg 	
[ii 	

HttpDeleteii	 
(ii 
$strii 
)ii 
]ii 
publicjj 
asyncjj 
Taskjj 
<jj 
IActionResultjj '
>jj' (
DeletePhotojj) 4
(jj4 5
intjj5 8
userIdjj9 ?
,jj? @
intjjA D
idjjE G
)jjG H
{kk 	
ifll 
(ll 
userIdll 
!=ll 
intll 
.ll 
Parsell #
(ll# $
Userll$ (
.ll( )
	FindFirstll) 2
(ll2 3

ClaimTypesll3 =
.ll= >
NameIdentifierll> L
)llL M
.llM N
ValuellN S
)llS T
)llT U
returnmm 
Unauthorizedmm #
(mm# $
)mm$ %
;mm% &
varnn 
usernn 
=nn 
awaitnn 
_reponn #
.nn# $
GetUsernn$ +
(nn+ ,
userIdnn, 2
)nn2 3
;nn3 4
ifoo 
(oo 
!oo 
useroo 
.oo 
Photosoo 
.oo 
Anyoo !
(oo! "
poo" #
=>oo$ &
poo' (
.oo( )
Idoo) +
==oo, .
idoo/ 1
)oo1 2
)oo2 3
returnpp 
Unauthorizedpp #
(pp# $
)pp$ %
;pp% &
varqq 
photoFromRepoqq 
=qq  
awaitqq! &
_repoqq' ,
.qq, -
GetPhotoqq- 5
(qq5 6
idqq6 8
)qq8 9
;qq9 :
ifrr 
(rr 
photoFromReporr 
.rr 
IsMainrr %
)rr% &
returnss 

BadRequestss !
(ss! "
$strss" E
)ssE F
;ssF G
iftt 
(tt 
photoFromRepott 
.tt 
PublicIdtt '
!=tt( *
nulltt+ /
)tt/ 0
{uu 
varvv 
deleteParamsvv  
=vv! "
newvv# &
DeletionParamsvv' 5
(vv5 6
photoFromRepovv6 C
.vvC D
PublicIdvvD L
)vvL M
;vvM N
varww 
resultww 
=ww 
_cloudinaryww )
.ww) *
Destroyww* 1
(ww1 2
deleteParamsww2 >
)ww> ?
;ww? @
ifxx 
(xx 
resultxx 
.xx 
Resultxx "
==xx# %
$strxx& *
)xx* +
{yy 
_repozz 
.zz 
Deletezz  
(zz  !
photoFromRepozz! .
)zz. /
;zz/ 0
}{{ 
}|| 
if}} 
(}} 
photoFromRepo}} 
.}} 
PublicId}} '
==}}( *
null}}+ /
)}}/ 0
{~~ 
_repo 
. 
Delete 
( 
photoFromRepo *
)* +
;+ ,
}
ÄÄ 
if
ÅÅ 
(
ÅÅ 
await
ÅÅ 
_repo
ÅÅ 
.
ÅÅ 
SaveAll
ÅÅ $
(
ÅÅ$ %
)
ÅÅ% &
)
ÅÅ& '
return
ÇÇ 
Ok
ÇÇ 
(
ÇÇ 
)
ÇÇ 
;
ÇÇ 
return
ÉÉ 

BadRequest
ÉÉ 
(
ÉÉ 
$str
ÉÉ ;
)
ÉÉ; <
;
ÉÉ< =
}
ÑÑ 	
}
ÜÜ 
}áá —#
bC:\Users\jonathan andujo\Documents\GitHub\mfatesttdev\DatingApp.API\Controllers\UsersController.cs
	namespace 	
	DatingApp
 
. 
API 
. 
Controllers #
{ 
[ 
	Authorize 
] 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
UsersController  
:! "
ControllerBase# 1
{ 
private 
readonly 
IDatingRepository *
_repo+ 0
;0 1
private 
readonly 
IMapper  
_mapper! (
;( )
public 
UsersController 
( 
IDatingRepository 0
repo1 5
,5 6
IMapper7 >
mapper? E
)E F
{ 	
_mapper 
= 
mapper 
; 
_repo 
= 
repo 
; 
} 	
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
IActionResult '
>' (
GetUsers) 1
(1 2
)2 3
{ 	
var 
users 
= 
await 
_repo #
.# $
GetUsers$ ,
(, -
)- .
;. /
var 
usersToReturn 
= 
_mapper  '
.' (
Map( +
<+ ,
IEnumerable, 7
<7 8
UserForListDto8 F
>F G
>G H
(H I
usersI N
)N O
;O P
return 
Ok 
( 
usersToReturn #
)# $
;$ %
}   	
["" 	
HttpGet""	 
("" 
$str"" 
,"" 
Name"" 
="" 
$str""  )
)"") *
]""* +
public## 
async## 
Task## 
<## 
IActionResult## '
>##' (
GetUser##) 0
(##0 1
int##1 4
id##5 7
)##7 8
{$$ 	
var%% 
user%% 
=%% 
await%% 
_repo%% "
.%%" #
GetUser%%# *
(%%* +
id%%+ -
)%%- .
;%%. /
var&& 
userToReturn&& 
=&& 
_mapper&& &
.&&& '
Map&&' *
<&&* +
UserForDetailedDto&&+ =
>&&= >
(&&> ?
user&&? C
)&&C D
;&&D E
return'' 
Ok'' 
('' 
userToReturn'' "
)''" #
;''# $
}(( 	
[** 	
HttpPut**	 
(** 
$str** 
)** 
]** 
public++ 
async++ 
Task++ 
<++ 
IActionResult++ '
>++' (

UpdateUser++) 3
(++3 4
int++4 7
id++8 :
,++: ;
[++< =
FromBody++= E
]++E F
UserForUpdateDto++F V
userForUpdateDto++W g
)++g h
{,, 	
if-- 
(-- 
id-- 
!=-- 
int-- 
.-- 
Parse-- 
(--  
User--  $
.--$ %
	FindFirst--% .
(--. /

ClaimTypes--/ 9
.--9 :
NameIdentifier--: H
)--H I
.--I J
Value--J O
)--O P
)--P Q
return.. 
Unauthorized.. #
(..# $
)..$ %
;..% &
var// 
userFromRepo// 
=// 
await//  %
_repo//& +
.//+ ,
GetUser//, 3
(//3 4
id//4 6
)//6 7
;//7 8
_mapper00 
.00 
Map00 
(00 
userForUpdateDto00 )
,00) *
userFromRepo00+ 7
)007 8
;008 9
if11 
(11 
await11 
_repo11 
.11 
SaveAll11 $
(11$ %
)11% &
)11& '
return22 
	NoContent22  
(22  !
)22! "
;22" #
throw44 
new44 
	Exception44 
(44  
$"44  "
Updating user 44" 0
{440 1
id441 3
}443 4
 failed on save444 C
"44C D
)44D E
;44E F
}55 	
}77 
}88 á
cC:\Users\jonathan andujo\Documents\GitHub\mfatesttdev\DatingApp.API\Controllers\ValuesController.cs
	namespace

 	
	DatingApp


 
.

 
API

 
.

 
Controllers

 #
{ 
[ 
	Authorize 
] 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
ValuesController !
:" #

Controller$ .
{ 
private 
readonly 
DataContext $
_context% -
;- .
public 
ValuesController 
(  
DataContext  +
context, 3
)3 4
{ 	
_context 
= 
context 
; 
} 	
[ 	
AllowAnonymous	 
] 
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
IActionResult '
>' (
GetVaues) 1
(1 2
)2 3
{ 	
var 
values 
= 
await 
_context '
.' (
Values( .
.. /
ToListAsync/ :
(: ;
); <
;< =
return 
Ok 
( 
values 
) 
; 
} 	
[ 	
AllowAnonymous	 
] 
[   	
HttpGet  	 
(   
$str   
)   
]   
public!! 
async!! 
Task!! 
<!! 
IActionResult!! '
>!!' (
GetValue!!) 1
(!!1 2
int!!2 5
id!!6 8
)!!8 9
{"" 	
return## 
Ok## 
(## 
await## 
_context## $
.##$ %
Values##% +
.##+ ,
FirstOrDefaultAsync##, ?
(##? @
x##@ A
=>##A C
x##D E
.##E F
Id##F H
==##I K
id##L N
)##N O
)##O P
;##P Q
}$$ 	
['' 	
HttpPost''	 
]'' 
public(( 
void(( 
Post(( 
((( 
[(( 
FromBody(( "
]((" #
string((# )
value((* /
)((/ 0
{)) 	
}** 	
[-- 	
HttpPut--	 
(-- 
$str-- 
)-- 
]-- 
public.. 
void.. 
Put.. 
(.. 
int.. 
id.. 
,.. 
[..  !
FromBody..! )
]..) *
string..* 0
value..1 6
)..6 7
{// 	
}00 	
[33 	

HttpDelete33	 
(33 
$str33 
)33 
]33 
public44 
void44 
Delete44 
(44 
int44 
id44 !
)44! "
{55 	
}66 	
}77 
}88 ˆ5
ZC:\Users\jonathan andujo\Documents\GitHub\mfatesttdev\DatingApp.API\Data\AuthRepository.cs
	namespace		 	
	DatingApp		
 
.		 
API		 
.		 
Data		 
{

 
public 

class 
AuthRepository 
:  !
IAuthRepository" 1
{ 
private 
readonly 
DataContext $
_context% -
;- .
public 
AuthRepository 
( 
DataContext )
context* 1
)1 2
{ 	
_context 
= 
context 
; 
} 	
async 
Task 
< 
User 
> 
IAuthRepository (
.( )
Login) .
(. /
string/ 5
userName6 >
,> ?
string@ F
passwordG O
)O P
{ 	
var 
user 
= 
await 
_context %
.% &
Users& +
.+ ,
Include, 3
(3 4
p4 5
=>6 8
p9 :
.: ;
Photos; A
)A B
.B C
FirstOrDefaultAsyncC V
(V W
xW X
=>Y [
x\ ]
.] ^
UserName^ f
==g i
userNamej r
)r s
;s t
if 
( 
user 
== 
null 
) 
return 
null 
; 
if 
( 
! 
VerifyPasswordHash #
(# $
password$ ,
,, -
user. 2
.2 3
PasswordHash3 ?
,? @
userA E
.E F
PasswordSaltF R
)R S
)S T
return 
null 
; 
return 
user 
; 
} 	
private 
bool 
VerifyPasswordHash '
(' (
string( .
password/ 7
,7 8
byte9 =
[= >
]> ?
passwordHash@ L
,L M
byteN R
[R S
]S T
passwordSaltU a
)a b
{   	
using!! 
(!! 
System!! 
.!! 
Security!! "
.!!" #
Cryptography!!# /
.!!/ 0

HMACSHA512!!0 :
hmac!!; ?
=!!@ A
new"" 
System"" 
."" 
Security"" 
.""  
Cryptography""  ,
."", -

HMACSHA512""- 7
(""7 8
passwordSalt""8 D
)""D E
)""E F
{## 
var$$ 
computedHash$$  
=$$! "
hmac$$# '
.$$' (
ComputeHash$$( 3
($$3 4
System$$4 :
.$$: ;
Text$$; ?
.$$? @
Encoding$$@ H
.$$H I
UTF8$$I M
.$$M N
GetBytes$$N V
($$V W
password$$W _
)$$_ `
)$$` a
;$$a b
for%% 
(%% 
int%% 
i%% 
=%% 
$num%% 
;%% 
i%%  !
<%%" #
computedHash%%$ 0
.%%0 1
Length%%1 7
;%%7 8
i%%9 :
++%%: <
)%%< =
{&& 
if'' 
('' 
computedHash'' $
[''$ %
i''% &
]''& '
!=''( *
passwordHash''+ 7
[''7 8
i''8 9
]''9 :
)'': ;
return''< B
false''C H
;''H I
}(( 
return)) 
true)) 
;)) 
}** 
}++ 	
async-- 
Task-- 
<-- 
User-- 
>-- 
IAuthRepository-- (
.--( )
Register--) 1
(--1 2
User--2 6
user--7 ;
,--; <
string--= C
password--D L
)--L M
{.. 	
byte// 
[// 
]// 
passwordHash// 
,//  
passwordSalt//! -
;//- .
CreatePasswordHash00 
(00 
password00 '
,00' (
out00) ,
passwordHash00- 9
,009 :
out00; >
passwordSalt00? K
)00K L
;00L M
user11 
.11 
PasswordHash11 
=11 
passwordHash11  ,
;11, -
user22 
.22 
PasswordSalt22 
=22 
passwordSalt22  ,
;22, -
await33 
_context33 
.33 
Users33  
.33  !
AddAsync33! )
(33) *
user33* .
)33. /
;33/ 0
await44 
_context44 
.44 
SaveChangesAsync44 +
(44+ ,
)44, -
;44- .
return66 
user66 
;66 
}77 	
private99 
void99 
CreatePasswordHash99 '
(99' (
string99( .
password99/ 7
,997 8
out999 <
byte99= A
[99A B
]99B C
passwordHash99D P
,99P Q
out99R U
byte99V Z
[99Z [
]99[ \
passwordSalt99] i
)99i j
{:: 	
using;; 
(;; 
System;; 
.;; 
Security;; "
.;;" #
Cryptography;;# /
.;;/ 0

HMACSHA512;;0 :
hmac;;; ?
=;;@ A
new<< 
System<< 
.<< 
Security<<  
.<<  !
Cryptography<<! -
.<<- .

HMACSHA512<<. 8
(<<8 9
)<<9 :
)<<: ;
{== 
passwordSalt>> 
=>> 
hmac>> #
.>># $
Key>>$ '
;>>' (
passwordHash?? 
=?? 
hmac?? #
.??# $
ComputeHash??$ /
(??/ 0
System??0 6
.??6 7
Text??7 ;
.??; <
Encoding??< D
.??D E
UTF8??E I
.??I J
GetBytes??J R
(??R S
password??S [
)??[ \
)??\ ]
;??] ^
}@@ 
}AA 	
asyncCC 
TaskCC 
<CC 
boolCC 
>CC 
IAuthRepositoryCC (
.CC( )

UserExistsCC) 3
(CC3 4
stringCC4 :
userNameCC; C
)CCC D
{DD 	
returnEE 
awaitEE 
_contextEE !
.EE! "
UsersEE" '
.EE' (
AnyAsyncEE( 0
(EE0 1
xEE1 2
=>EE2 4
xEE5 6
.EE6 7
UserNameEE7 ?
==EE@ B
userNameEEC K
)EEK L
;EEL M
}FF 	
}GG 
}HH Ï	
WC:\Users\jonathan andujo\Documents\GitHub\mfatesttdev\DatingApp.API\Data\DataContext.cs
	namespace 	
	DatingApp
 
. 
API 
. 
	DatingApp !
{ 
public 

class 
DataContext 
: 
	DbContext (
{ 
public 
DataContext 
( 
DbContextOptions +
<+ ,
DataContext, 7
>7 8
options9 @
)@ A
:B C
baseD H
(H I
optionsI P
)P Q
{R S
}T U
public		 
DbSet		 
<		 
Value		 
>		 
Values		 "
{		# $
get		% (
;		( )
set		* -
;		- .
}		/ 0
public

 
DbSet

 
<

 
User

 
>

 
Users

  
{

! "
get

# &
;

& '
set

( +
;

+ ,
}

- .
public 
DbSet 
< 
Photo 
> 
Photos "
{# $
get% (
;( )
set* -
;- .
}/ 0
} 
} ç"
\C:\Users\jonathan andujo\Documents\GitHub\mfatesttdev\DatingApp.API\Data\DatingRepository.cs
	namespace 	
	DatingApp
 
. 
API 
. 
Data 
{		 
public

 

class

 
DatingRepository

 !
:

" #
IDatingRepository

$ 5
{ 
private 
readonly 
DataContext $
_context% -
;- .
public 
DatingRepository 
(  
DataContext  +
context, 3
)3 4
{ 	
_context 
= 
context 
; 
} 	
void 
IDatingRepository 
. 
Add "
<" #
T# $
>$ %
(% &
T& '
entity( .
). /
{ 	
_context 
. 
Add 
( 
entity 
) 
;  
} 	
void 
IDatingRepository 
. 
Delete %
<% &
T& '
>' (
(( )
T) *
entity+ 1
)1 2
{ 	
_context 
. 
Remove 
( 
entity "
)" #
;# $
} 	
public	 
async 
Task 
< 
Photo  
>  !
GetMainPhotoForUser" 5
(5 6
int6 9
userId: @
)@ A
{ 	
return 
await 
_context !
.! "
Photos" (
.( )
Where) .
(. /
u/ 0
=>1 3
u4 5
.5 6
UserId6 <
=== ?
userId@ F
)F G
. 
FirstOrDefaultAsync $
($ %
p% &
=>' )
p* +
.+ ,
IsMain, 2
)2 3
;3 4
}   	
public!!	 
async!! 
Task!! 
<!! 
Photo!!  
>!!  !
GetPhoto!!" *
(!!* +
int!!+ .
id!!/ 1
)!!1 2
{"" 	
var## 
photo## 
=## 
await## 
_context## &
.##& '
Photos##' -
.##- .
FirstOrDefaultAsync##. A
(##A B
p##B C
=>##D F
p##G H
.##H I
Id##I K
==##L N
id##O Q
)##Q R
;##R S
return$$ 
photo$$ 
;$$ 
}%% 	
async'' 
Task'' 
<'' 
User'' 
>'' 
IDatingRepository'' *
.''* +
GetUser''+ 2
(''2 3
int''3 6
id''7 9
)''9 :
{(( 	
return)) 
await)) 
_context)) !
.))! "
Users))" '
.))' (
Include))( /
())/ 0
p))0 1
=>))2 4
p))5 6
.))6 7
Photos))7 =
)))= >
.))> ?
FirstOrDefaultAsync))? R
())R S
u))S T
=>))U W
u))X Y
.))Y Z
Id))Z \
==))] _
id))` b
)))b c
;))c d
}** 	
async,, 
Task,, 
<,, 
IEnumerable,, 
<,, 
User,, #
>,,# $
>,,$ %
IDatingRepository,,& 7
.,,7 8
GetUsers,,8 @
(,,@ A
),,A B
{-- 	
return.. 
await.. 
_context.. !
...! "
Users.." '
...' (
Include..( /
(../ 0
p..0 1
=>..2 4
p..5 6
...6 7
Photos..7 =
)..= >
...> ?
ToListAsync..? J
(..J K
)..K L
;..L M
}// 	
async11 
Task11 
<11 
bool11 
>11 
IDatingRepository11 *
.11* +
SaveAll11+ 2
(112 3
)113 4
{22 	
return33 
await33 
_context33 !
.33! "
SaveChangesAsync33" 2
(332 3
)333 4
>335 6
$num337 8
;338 9
}44 	
}55 
}66 ¬
[C:\Users\jonathan andujo\Documents\GitHub\mfatesttdev\DatingApp.API\Data\IAuthRepository.cs
	namespace 	
	DatingApp
 
. 
API 
. 
Data 
{ 
public 

	interface 
IAuthRepository $
{ 
Task 
< 
User 
> 
Register 
( 
User  
user! %
,% &
string' -
password. 6
)6 7
;7 8
Task		 
<		 
User		 
>		 
Login		 
(		 
string		 
userName		  (
,		( )
string		* 0
password		1 9
)		9 :
;		: ;
Task

 
<

 
bool

 
>

 

UserExists

 
(

 
string

 $
userName

% -
)

- .
;

. /
} 
} €
]C:\Users\jonathan andujo\Documents\GitHub\mfatesttdev\DatingApp.API\Data\IDatingRepository.cs
	namespace 	
	DatingApp
 
. 
API 
. 
Data 
{ 
public 

	interface 
IDatingRepository &
{ 
void			 
Add		 
<		 
T		 
>		 
(		 
T		 
entity		 
)		 
where		 $
T		% &
:		& '
class		( -
;		- .
void

	 
Delete

 
<

 
T

 
>

 
(

 
T

 
entity

  
)

  !
where

" '
T

( )
:

) *
class

+ 0
;

0 1
Task	 
< 
bool 
> 
SaveAll 
( 
) 
; 
Task	 
< 
IEnumerable 
< 
User 
> 
>  
GetUsers! )
() *
)* +
;+ ,
Task	 
< 
User 
> 
GetUser 
( 
int 
id  "
)" #
;# $
Task	 
< 
Photo 
> 
GetPhoto 
( 
int !
id" $
)$ %
;% &
Task	 
< 
Photo 
> 
GetMainPhotoForUser (
(( )
int) ,
userId- 3
)3 4
;4 5
} 
} õ
PC:\Users\jonathan andujo\Documents\GitHub\mfatesttdev\DatingApp.API\Data\Seed.cs
	namespace 	
	DatingApp
 
. 
API 
. 
Data 
{ 
public 

class 
Seed 
{		 
private

 
readonly

 
DataContext

 $
_context

% -
;

- .
public 
Seed 
( 
DataContext 
context  '
)' (
{ 	
_context 
= 
context 
; 
} 	
public 
void 
	SeedUsers 
( 
) 
{ 	
var 
userData 
= 
System !
.! "
IO" $
.$ %
File% )
.) *
ReadAllText* 5
(5 6
$str6 N
)N O
;O P
var 
users 
= 
JsonConvert #
.# $
DeserializeObject$ 5
<5 6
List6 :
<: ;
User; ?
>? @
>@ A
(A B
userDataB J
)J K
;K L
foreach 
( 
var 
user 
in 
users  %
)% &
{ 
byte 
[ 
] 
passwordHash #
,# $
passwordSalt$ 0
;0 1
CreatePasswordHash "
(" #
$str# -
,- .
out. 1
passwordHash2 >
,> ?
out@ C
passwordSaltD P
)P Q
;Q R
user 
. 
PasswordHash !
=" #
passwordHash$ 0
;0 1
user 
. 
PasswordSalt !
=" #
passwordSalt$ 0
;0 1
user 
. 
UserName 
= 
user  $
.$ %
UserName% -
.- .
ToLower. 5
(5 6
)6 7
;7 8
_context 
. 
Users 
. 
Add "
(" #
user# '
)' (
;( )
} 
_context   
.   
SaveChanges    
(    !
)  ! "
;  " #
}!! 	
private##
 
void## 
CreatePasswordHash## )
(##) *
string##* 0
password##1 9
,##9 :
out##; >
byte##? C
[##C D
]##D E
passwordHash##F R
,##R S
out##T W
byte##X \
[##\ ]
]##] ^
passwordSalt##_ k
)##k l
{$$ 	
using%% 
(%% 
System%% 
.%% 
Security%% "
.%%" #
Cryptography%%# /
.%%/ 0

HMACSHA512%%0 :
hmac%%; ?
=%%@ A
new&& 
System&& 
.&& 
Security&&  
.&&  !
Cryptography&&! -
.&&- .

HMACSHA512&&. 8
(&&8 9
)&&9 :
)&&: ;
{'' 
passwordSalt(( 
=(( 
hmac(( #
.((# $
Key(($ '
;((' (
passwordHash)) 
=)) 
hmac)) #
.))# $
ComputeHash))$ /
())/ 0
System))0 6
.))6 7
Text))7 ;
.)); <
Encoding))< D
.))D E
UTF8))E I
.))I J
GetBytes))J R
())R S
password))S [
)))[ \
)))\ ]
;))] ^
}** 
}++ 	
},, 
}-- ∏

_C:\Users\jonathan andujo\Documents\GitHub\mfatesttdev\DatingApp.API\Dtos\PhotoForCreationDto.cs
	namespace 

	DatingApp 
. 
API 
. 
Dtos 
{ 
public 

class 
PhotoForCreationDto $
{ 
public 
string 
Url 
{ 
get 
;  
set! $
;$ %
}& '
public 
	IFormFile 
File 
{ 
get  #
;# $
set% (
;( )
}* +
public		 
string		 
Description		 !
{		" #
get		$ '
;		' (
set		) ,
;		, -
}		. /
public

 
DateTime

 
	DateAdded

 !
{

" #
get

$ '
;

' (
set

) ,
;

, -
}

. /
public 
string 
PublicId 
{  
get! $
;$ %
set& )
;) *
}+ ,
public	 
PhotoForCreationDto #
(# $
)$ %
{ 	
	DateAdded 
= 
DateTime  
.  !
Now! $
;$ %
} 	
} 
} Ë	
]C:\Users\jonathan andujo\Documents\GitHub\mfatesttdev\DatingApp.API\Dtos\PhotoForReturnDto.cs
	namespace 

	DatingApp 
. 
API 
. 
Dtos 
{ 
public 

class 
PhotoForReturnDto "
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
Url 
{ 
get 
;  
set! $
;$ %
}& '
public 
string 
Description !
{" #
get$ '
;' (
set) ,
;, -
}. /
public		 
DateTime		 
	DateAdded		 !
{		" #
get		$ '
;		' (
set		) ,
;		, -
}		. /
public

 
bool

 
IsMain

 
{

 
get

  
;

  !
set

" %
;

% &
}

' (
public 
string 
PublicId 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} –
`C:\Users\jonathan andujo\Documents\GitHub\mfatesttdev\DatingApp.API\Dtos\PhotosForDetailedDto.cs
	namespace 	
	DatingApp
 
. 
API 
. 
Dtos 
{ 
public 

class  
PhotosForDetailedDto %
{ 
public	 
int 
Id 
{ 
get 
; 
set !
;! "
}# $
public	 
string 
Url 
{ 
get  
;  !
set" %
;% &
}' (
public			 
string		 
Description		 "
{		# $
get		% (
;		( )
set		* -
;		- .
}		/ 0
public

	 
DateTime

 
	DateAdded

 "
{

# $
get

% (
;

( )
set

* -
;

- .
}

/ 0
public	 
bool 
IsMain 
{ 
get !
;! "
set# &
;& '
}( )
} 
} ä
^C:\Users\jonathan andujo\Documents\GitHub\mfatesttdev\DatingApp.API\Dtos\UserForDetailedDto.cs
	namespace 	
	DatingApp
 
. 
API 
. 
Dtos 
{ 
public 

class 
UserForDetailedDto #
{ 
public		 
int		 
Id		 
{		 
get		 
;		 
set		  
;		  !
}		" #
public

 
string

 
UserName

 
{

  
get

! $
;

$ %
set

& )
;

) *
}

+ ,
public 
string 
Gender 
{ 
get "
;" #
set$ '
;' (
}) *
public 
int 
Age 
{ 
get 
; 
set !
;! "
}# $
public 
string 
KnownAs 
{ 
get  #
;# $
set% (
;( )
}* +
public 
DateTime 
Created 
{  !
get" %
;% &
set' *
;* +
}, -
public 
DateTime 

LastActive "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 
Introduction "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 

LookingFor  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
string 
	Interests 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
City 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
Country 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
PhotoUrl 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
ICollection 
<  
PhotosForDetailedDto /
>/ 0
Photos1 7
{8 9
get: =
;= >
set? B
;B C
}D E
} 
} »
ZC:\Users\jonathan andujo\Documents\GitHub\mfatesttdev\DatingApp.API\Dtos\UserForListDto.cs
	namespace 	
	DatingApp
 
. 
API 
. 
Dtos 
{ 
public 

class 
UserForListDto 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public		 
string		 
Gender		 
{		 
get		 "
;		" #
set		$ '
;		' (
}		) *
public

 
int

 
Age

 
{

 
get

 
;

 
set

 !
;

! "
}

# $
public 
string 
KnownAs 
{ 
get  #
;# $
set% (
;( )
}* +
public 
DateTime 
Created 
{  !
get" %
;% &
set' *
;* +
}, -
public 
DateTime 

LastActive "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 
City 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
Country 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
PhotoUrl 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} ¨
[C:\Users\jonathan andujo\Documents\GitHub\mfatesttdev\DatingApp.API\Dtos\UserForLoginDto.cs
	namespace 	
	DatingApp
 
. 
API 
. 
Dtos 
{ 
public 

class 
UserForLoginDto  
{ 
[ 	
Required	 
] 
[ 	
StringLength	 
( 
$num 
, 
MinimumLength '
=( )
$num* +
,+ ,
ErrorMessage- 9
=: ;
$str< r
)r s
]s t
public		 
string		 
UserName		 
{		  
get		! $
;		$ %
set		& )
;		) *
}		+ ,
[ 	
Required	 
] 
[ 	
StringLength	 
( 
$num 
, 
MinimumLength &
=' (
$num) *
,* +
ErrorMessage, 8
=9 :
$str; q
)q r
]r s
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 	
Required	 
] 
[ 	
StringLength	 
( 
$num 
, 
MinimumLength &
=' (
$num) *
,* +
ErrorMessage, 8
=9 :
$str; d
)d e
]e f
public 
string 
MfaCode 
{ 
get  #
;# $
set% (
;( )
}* +
} 
} ı
^C:\Users\jonathan andujo\Documents\GitHub\mfatesttdev\DatingApp.API\Dtos\UserForRegisterDto.cs
	namespace 	
	DatingApp
 
. 
API 
. 
Dtos 
{ 
public 

class 
UserForRegisterDto #
{ 
[ 	
Required	 
] 
[			 

StringLength		
 
(		 
$num		 
,		 
MinimumLength		 (
=		) *
$num		+ ,
,		, -
ErrorMessage		. :
=		; <
$str		= s
)		s t
]		t u
public

 
string

 
UserName

 
{

  
get

! $
;

$ %
set

& )
;

) *
}

+ ,
[ 	
Required	 
] 
[ 	
StringLength	 
( 
$num 
, 
MinimumLength &
=' (
$num) *
,* +
ErrorMessage, 8
=9 :
$str; q
)q r
]r s
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 	
Required	 
] 
public 
string 
Gender 
{ 
get "
;" #
set$ '
;' (
}) *
[ 	
Required	 
] 
public 
string 
KnownAs 
{ 
get  #
;# $
set% (
;( )
}* +
[ 	
Required	 
] 
public 
DateTime 
DateOfBirth #
{$ %
get& )
;) *
set+ .
;. /
}0 1
[ 	
Required	 
] 
public 
string 
City 
{ 
get  
;  !
set" %
;% &
}' (
[ 	
Required	 
] 
public 
string 
Country 
{ 
get  #
;# $
set% (
;( )
}* +
public 
DateTime 
Created 
{  !
get" %
;% &
set' *
;* +
}, -
public 
DateTime 

LastActive "
{# $
get% (
;( )
set* -
;- .
}/ 0
public  	 
UserForRegisterDto   "
(  " #
)  # $
{!! 	
Created"" 
="" 
DateTime"" 
."" 
Now"" "
;""" #

LastActive## 
=## 
DateTime## !
.##! "
Now##" %
;##% &
}$$ 	
}%% 
}&& ÷
\C:\Users\jonathan andujo\Documents\GitHub\mfatesttdev\DatingApp.API\Dtos\UserForUpdateDto.cs
	namespace 	
	DatingApp
 
. 
API 
. 
Dtos 
{ 
public 

class 
UserForUpdateDto !
{ 
public 
string 
Introduction "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 

LookingFor  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
string 
	Interests 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
City 
{ 
get  
;  !
set" %
;% &
}' (
public		 
string		 
Country		 
{		 
get		  #
;		# $
set		% (
;		( )
}		* +
}

 
} Ê
aC:\Users\jonathan andujo\Documents\GitHub\mfatesttdev\DatingApp.API\Helpers\AutoMapperProfiles.cs
	namespace 	
	DatingApp
 
. 
API 
. 
Helpers 
{ 
public 

class 
AutoMapperProfiles #
:$ %
Profile& -
{		 
public

 
AutoMapperProfiles

 !
(

! "
)

" #
{ 	
	CreateMap 
< 
User 
, 
UserForDetailedDto .
>. /
(/ 0
)0 1
. 
	ForMember 
( 
dest 
=> 
dest  $
.$ %
PhotoUrl% -
,- .
opt/ 2
=>3 5
{6 7
opt 
. 
MapFrom 
( 
src  
=>! #
src$ '
.' (
Photos( .
.. /
FirstOrDefault/ =
(= >
p> ?
=>@ B
pC D
.D E
IsMainE K
)K L
.L M
UrlM P
)P Q
;Q R
} 
) 
. 
	ForMember 
( 
dest 
=> 
dest #
.# $
Age$ '
,' (
opt) ,
=>- /
{0 1
opt 
. 
ResolveUsing  
(  !
d! "
=># %
d& '
.' (
DateOfBirth( 3
.3 4
CalculateAge4 @
(@ A
)A B
)B C
;C D
} 
) 
; 
	CreateMap 
< 
User 
, 
UserForListDto *
>* +
(+ ,
), -
. 
	ForMember 
( 
dest 
=> 
dest  $
.$ %
PhotoUrl% -
,- .
opt/ 2
=>3 5
{6 7
opt 
. 
MapFrom 
( 
src  
=>! #
src$ '
.' (
Photos( .
.. /
FirstOrDefault/ =
(= >
p> ?
=>@ B
pC D
.D E
IsMainE K
)K L
.L M
UrlM P
)P Q
;Q R
} 
) 
. 
	ForMember 
( 
dest 
=> 
dest  $
.$ %
Age% (
,( )
opt* -
=>. 0
{1 2
opt 
. 
ResolveUsing  
(  !
d! "
=># %
d& '
.' (
DateOfBirth( 3
.3 4
CalculateAge4 @
(@ A
)A B
)B C
;C D
} 
) 
; 
	CreateMap 
< 
Photo 
,  
PhotosForDetailedDto 1
>1 2
(2 3
)3 4
;4 5
	CreateMap 
< 
UserForUpdateDto &
,& '
User( ,
>, -
(- .
). /
;/ 0
	CreateMap 
< 
Photo 
, 
PhotoForReturnDto .
>. /
(/ 0
)0 1
;1 2
	CreateMap 
< 
PhotoForCreationDto )
,) *
Photo+ 0
>0 1
(1 2
)2 3
;3 4
	CreateMap   
<   
UserForRegisterDto   )
,  ) *
User  + /
>  / 0
(  0 1
)  1 2
;  2 3
}!! 	
}"" 
}## Å^
UC:\Users\jonathan andujo\Documents\GitHub\mfatesttdev\DatingApp.API\Helpers\Base32.cs
public 
static 
class 
Base32 
{ 
private 
static 
readonly 
char  
[  !
]! "
DIGITS# )
;) *
private		 
static		 
readonly		 
int		 
MASK		  $
;		$ %
private

 
static

 
readonly

 
int

 
SHIFT

  %
;

% &
private 
static 

Dictionary 
< 
char "
," #
int$ '
>' (
CHAR_MAP) 1
=2 3
new4 7

Dictionary8 B
<B C
charC G
,G H
intI L
>L M
(M N
)N O
;O P
private 
const 
string 
	SEPARATOR "
=# $
$str% (
;( )
static 

Base32 
( 
) 
{ 
DIGITS 
= 
$str 3
.3 4
ToCharArray4 ?
(? @
)@ A
;A B
MASK 
= 
DIGITS 
. 
Length 
- 
$num  
;  !
SHIFT 
= !
numberOfTrailingZeros %
(% &
DIGITS& ,
., -
Length- 3
)3 4
;4 5
for 
( 
int 
i 
= 
$num 
; 
i 
< 
DIGITS "
." #
Length# )
;) *
i+ ,
++, .
). /
CHAR_MAP0 8
[8 9
DIGITS9 ?
[? @
i@ A
]A B
]B C
=D E
iF G
;G H
} 
private 
static 
int !
numberOfTrailingZeros ,
(, -
int- 0
i1 2
)2 3
{4 5
int 
y 
; 
if 

( 
i 
== 
$num 
) 
return 
$num 
; 
int 
n 
= 
$num 
; 
y 	
=
 
i 
<< 
$num 
; 
if 
( 
y 
!= 
$num 
)  
{! "
n# $
=% &
n' (
-) *
$num+ -
;- .
i/ 0
=1 2
y3 4
;4 5
}6 7
y 	
=
 
i 
<< 
$num 
; 
if 
( 
y 
!= 
$num 
) 
{  !
n" #
=$ %
n& '
-( )
$num* +
;+ ,
i- .
=/ 0
y1 2
;2 3
}4 5
y 	
=
 
i 
<< 
$num 
; 
if 
( 
y 
!= 
$num 
) 
{  !
n" #
=$ %
n& '
-( )
$num* +
;+ ,
i- .
=/ 0
y1 2
;2 3
}4 5
y 	
=
 
i 
<< 
$num 
; 
if 
( 
y 
!= 
$num 
) 
{  !
n" #
=$ %
n& '
-( )
$num* +
;+ ,
i- .
=/ 0
y1 2
;2 3
}4 5
return 
n 
- 
( 
int 
) 
( 
( 
uint 
) 
(  
i  !
<<" $
$num% &
)& '
>>( *
$num+ -
)- .
;. /
} 
public!! 

static!! 
byte!! 
[!! 
]!! 
Decode!! 
(!!  
string!!  &
encoded!!' .
)!!. /
{!!0 1
encoded## 
=## 
encoded## 
.## 
Trim## 
(## 
)##  
.##  !
Replace##! (
(##( )
	SEPARATOR##) 2
,##2 3
$str##4 6
)##6 7
;##7 8
encoded(( 
=(( 
Regex(( 
.(( 
Replace(( 
(((  
encoded((  '
,((' (
$str(() 0
,((0 1
$str((2 4
)((4 5
;((5 6
encoded++ 
=++ 
encoded++ 
.++ 
ToUpper++ !
(++! "
)++" #
;++# $
if,, 

(,, 
encoded,, 
.,, 
Length,, 
==,, 
$num,, 
),,  
{,,! "
return-- 
new-- 
byte-- 
[-- 
$num-- 
]-- 
;-- 
}.. 	
int// 
encodedLength// 
=// 
encoded// #
.//# $
Length//$ *
;//* +
int00 
	outLength00 
=00 
encodedLength00 %
*00& '
SHIFT00( -
/00. /
$num000 1
;001 2
byte11 
[11 
]11 
result11 
=11 
new11 
byte11  
[11  !
	outLength11! *
]11* +
;11+ ,
int22 
buffer22 
=22 
$num22 
;22 
int33 
next33 
=33 
$num33 
;33 
int44 
bitsLeft44 
=44 
$num44 
;44 
foreach55 
(55 
char55 
c55 
in55 
encoded55 "
)55" #
{55$ %
if66 
(66 
!66 
CHAR_MAP66 
.66 
ContainsKey66 %
(66% &
c66& '
)66' (
)66( )
{66* +
throw77 
new77 
DecodingException77 +
(77+ ,
$str77, A
+77B C
c77D E
)77E F
;77F G
}88 
buffer99 
<<=99 
SHIFT99 
;99 
buffer:: 
|=:: 
CHAR_MAP:: 
[:: 
c::  
]::  !
&::" #
MASK::$ (
;::( )
bitsLeft;; 
+=;; 
SHIFT;; 
;;; 
if<< 
(<< 
bitsLeft<< 
>=<< 
$num<< 
)<< 
{<<  
result== 
[== 
next== 
++== 
]== 
===  
(==! "
byte==" &
)==& '
(==' (
buffer==( .
>>==/ 1
(==2 3
bitsLeft==3 ;
-==< =
$num==> ?
)==? @
)==@ A
;==A B
bitsLeft>> 
-=>> 
$num>> 
;>> 
}?? 
}@@ 	
returnFF 
resultFF 
;FF 
}GG 
publicJJ 

staticJJ 
stringJJ 
EncodeJJ 
(JJ  
byteJJ  $
[JJ$ %
]JJ% &
dataJJ' +
,JJ+ ,
boolJJ- 1
	padOutputJJ2 ;
=JJ< =
falseJJ> C
)JJC D
{JJE F
ifKK 

(KK 
dataKK 
.KK 
LengthKK 
==KK 
$numKK 
)KK 
{KK 
returnLL 
$strLL 
;LL 
}MM 	
ifQQ 

(QQ 
dataQQ 
.QQ 
LengthQQ 
>=QQ 
(QQ 
$numQQ 
<<QQ  
$numQQ! #
)QQ# $
)QQ$ %
{QQ& '
throwSS 
newSS '
ArgumentOutOfRangeExceptionSS 1
(SS1 2
$strSS2 8
)SS8 9
;SS9 :
}TT 	
intVV 
outputLengthVV 
=VV 
(VV 
dataVV  
.VV  !
LengthVV! '
*VV( )
$numVV* +
+VV, -
SHIFTVV. 3
-VV4 5
$numVV6 7
)VV7 8
/VV9 :
SHIFTVV; @
;VV@ A
StringBuilderWW 
resultWW 
=WW 
newWW "
StringBuilderWW# 0
(WW0 1
outputLengthWW1 =
)WW= >
;WW> ?
intYY 
bufferYY 
=YY 
dataYY 
[YY 
$numYY 
]YY 
;YY 
intZZ 
nextZZ 
=ZZ 
$numZZ 
;ZZ 
int[[ 
bitsLeft[[ 
=[[ 
$num[[ 
;[[ 
while\\ 
(\\ 
bitsLeft\\ 
>\\ 
$num\\ 
||\\ 
next\\ #
<\\$ %
data\\& *
.\\* +
Length\\+ 1
)\\1 2
{\\3 4
if]] 
(]] 
bitsLeft]] 
<]] 
SHIFT]]  
)]]  !
{]]" #
if^^ 
(^^ 
next^^ 
<^^ 
data^^ 
.^^  
Length^^  &
)^^& '
{^^( )
buffer__ 
<<=__ 
$num__  
;__  !
buffer`` 
|=`` 
(`` 
data`` #
[``# $
next``$ (
++``( *
]``* +
&``, -
$num``. 2
)``2 3
;``3 4
bitsLeftaa 
+=aa 
$numaa  !
;aa! "
}bb 
elsebb 
{bb 
intcc 
padcc 
=cc 
SHIFTcc #
-cc$ %
bitsLeftcc& .
;cc. /
bufferdd 
<<=dd 
paddd "
;dd" #
bitsLeftee 
+=ee 
padee  #
;ee# $
}ff 
}gg 
inthh 
indexhh 
=hh 
MASKhh 
&hh 
(hh  
bufferhh  &
>>hh' )
(hh* +
bitsLefthh+ 3
-hh4 5
SHIFThh6 ;
)hh; <
)hh< =
;hh= >
bitsLeftii 
-=ii 
SHIFTii 
;ii 
resultjj 
.jj 
Appendjj 
(jj 
DIGITSjj  
[jj  !
indexjj! &
]jj& '
)jj' (
;jj( )
}kk 	
ifll 

(ll 
	padOutputll 
)ll 
{ll 
intmm 
paddingmm 
=mm 
$nummm 
-mm 
(mm 
resultmm %
.mm% &
Lengthmm& ,
%mm- .
$nummm/ 0
)mm0 1
;mm1 2
ifnn 
(nn 
paddingnn 
>nn 
$numnn 
)nn 
resultnn #
.nn# $
Appendnn$ *
(nn* +
newnn+ .
stringnn/ 5
(nn5 6
$charnn6 9
,nn9 :
paddingnn; B
==nnC E
$numnnF G
?nnH I
$numnnJ K
:nnL M
paddingnnN U
)nnU V
)nnV W
;nnW X
}oo 	
returnpp 
resultpp 
.pp 
ToStringpp 
(pp 
)pp  
;pp  !
}qq 
privatess 
classss 
DecodingExceptionss #
:ss$ %
	Exceptionss& /
{ss0 1
publictt 
DecodingExceptiontt  
(tt  !
stringtt! '
messagett( /
)tt/ 0
:tt1 2
basett3 7
(tt7 8
messagett8 ?
)tt? @
{ttA B
}uu 	
}vv 
}ww ¶
aC:\Users\jonathan andujo\Documents\GitHub\mfatesttdev\DatingApp.API\Helpers\CloudinarySettings.cs
	namespace 	
	DatingApp
 
. 
API 
. 
Helpers 
{ 
public 

class 
CloudinarySettings #
{ 
public 
string 
	CloudName 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
ApiKey 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
	ApiSecret 
{  !
get" %
;% &
set' *
;* +
}, -
} 
}		 ê
YC:\Users\jonathan andujo\Documents\GitHub\mfatesttdev\DatingApp.API\Helpers\Extensions.cs
	namespace 	
	DatingApp
 
. 
API 
. 
Helpers 
{ 
public 

static 
class 

Extensions "
{ 
public 
static 
void 
AddApplicationError .
(. /
this/ 3
HttpResponse4 @
responseA I
,I J
stringK Q
messageR Y
)Y Z
{		 	
response


 
.

 
Headers

 
.

 
Add

 
(

 
$str

 2
,

2 3
message

4 ;
)

; <
;

< =
response
 
. 
Headers 
. 
Add 
( 
$str >
,> ?
$str@ S
)S T
;T U
response
 
. 
Headers 
. 
Add 
( 
$str <
,< =
$str= @
)@ A
;A B
} 	
public 
static 
int 
CalculateAge &
(& '
this' +
DateTime, 4
TheDateTime5 @
)@ A
{ 	
var
 
age 
= 
DateTime 
. 
Today "
." #
Year# '
-( )
TheDateTime* 5
.5 6
Year6 :
;: ;
if
 
( 
TheDateTime 
. 
AddYears !
(! "
age" %
)% &
>' (
DateTime) 1
.1 2
Today2 7
)7 8
age 
-- 
; 
return
 
age 
; 
} 	
} 
} „M
nC:\Users\jonathan andujo\Documents\GitHub\mfatesttdev\DatingApp.API\Migrations\20190403155309_InitialCreate.cs
	namespace 	
	DatingApp
 
. 
API 
. 

Migrations "
{ 
public 

partial 
class 
InitialCreate &
:' (
	Migration) 2
{ 
	protected		 
override		 
void		 
Up		  "
(		" #
MigrationBuilder		# 3
migrationBuilder		4 D
)		D E
{

 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
nullable+ 3
:3 4
false5 :
): ;
. 

Annotation #
(# $
$str$ :
,: ;
true< @
)@ A
,A B
City 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
nullable0 8
:8 9
true: >
)> ?
,? @
Country 
= 
table #
.# $
Column$ *
<* +
string+ 1
>1 2
(2 3
nullable3 ;
:; <
true= A
)A B
,B C
Created 
= 
table #
.# $
Column$ *
<* +
DateTime+ 3
>3 4
(4 5
nullable5 =
:= >
false? D
)D E
,E F
DateOfBirth 
=  !
table" '
.' (
Column( .
<. /
DateTime/ 7
>7 8
(8 9
nullable9 A
:A B
falseC H
)H I
,I J
Gender 
= 
table "
." #
Column# )
<) *
string* 0
>0 1
(1 2
nullable2 :
:: ;
true< @
)@ A
,A B
	Interests 
= 
table  %
.% &
Column& ,
<, -
string- 3
>3 4
(4 5
nullable5 =
:= >
true? C
)C D
,D E
Introduction  
=! "
table# (
.( )
Column) /
</ 0
string0 6
>6 7
(7 8
nullable8 @
:@ A
trueB F
)F G
,G H
KnownAs 
= 
table #
.# $
Column$ *
<* +
string+ 1
>1 2
(2 3
nullable3 ;
:; <
true= A
)A B
,B C

LastActive 
=  
table! &
.& '
Column' -
<- .
DateTime. 6
>6 7
(7 8
nullable8 @
:@ A
falseB G
)G H
,H I

LookingFor 
=  
table! &
.& '
Column' -
<- .
string. 4
>4 5
(5 6
nullable6 >
:> ?
true@ D
)D E
,E F
PasswordHash  
=! "
table# (
.( )
Column) /
</ 0
byte0 4
[4 5
]5 6
>6 7
(7 8
nullable8 @
:@ A
trueB F
)F G
,G H
PasswordSalt  
=! "
table# (
.( )
Column) /
</ 0
byte0 4
[4 5
]5 6
>6 7
(7 8
nullable8 @
:@ A
trueB F
)F G
,G H
UserName 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
nullable4 <
:< =
true> B
)B C
} 
, 
constraints 
: 
table "
=># %
{   
table!! 
.!! 

PrimaryKey!! $
(!!$ %
$str!!% /
,!!/ 0
x!!1 2
=>!!3 5
x!!6 7
.!!7 8
Id!!8 :
)!!: ;
;!!; <
}"" 
)"" 
;"" 
migrationBuilder$$ 
.$$ 
CreateTable$$ (
($$( )
name%% 
:%% 
$str%% 
,%% 
columns&& 
:&& 
table&& 
=>&& !
new&&" %
{'' 
Id(( 
=(( 
table(( 
.(( 
Column(( %
<((% &
int((& )
>(() *
(((* +
nullable((+ 3
:((3 4
false((5 :
)((: ;
.)) 

Annotation)) #
())# $
$str))$ :
,)): ;
true))< @
)))@ A
,))A B
Name** 
=** 
table**  
.**  !
Column**! '
<**' (
string**( .
>**. /
(**/ 0
nullable**0 8
:**8 9
true**: >
)**> ?
}++ 
,++ 
constraints,, 
:,, 
table,, "
=>,,# %
{-- 
table.. 
... 

PrimaryKey.. $
(..$ %
$str..% 0
,..0 1
x..2 3
=>..4 6
x..7 8
...8 9
Id..9 ;
)..; <
;..< =
}// 
)// 
;// 
migrationBuilder11 
.11 
CreateTable11 (
(11( )
name22 
:22 
$str22 
,22 
columns33 
:33 
table33 
=>33 !
new33" %
{44 
Id55 
=55 
table55 
.55 
Column55 %
<55% &
int55& )
>55) *
(55* +
nullable55+ 3
:553 4
false555 :
)55: ;
.66 

Annotation66 #
(66# $
$str66$ :
,66: ;
true66< @
)66@ A
,66A B
	DateAdded77 
=77 
table77  %
.77% &
Column77& ,
<77, -
DateTime77- 5
>775 6
(776 7
nullable777 ?
:77? @
false77A F
)77F G
,77G H
Description88 
=88  !
table88" '
.88' (
Column88( .
<88. /
string88/ 5
>885 6
(886 7
nullable887 ?
:88? @
true88A E
)88E F
,88F G
IsMain99 
=99 
table99 "
.99" #
Column99# )
<99) *
bool99* .
>99. /
(99/ 0
nullable990 8
:998 9
false99: ?
)99? @
,99@ A
PublicId:: 
=:: 
table:: $
.::$ %
Column::% +
<::+ ,
string::, 2
>::2 3
(::3 4
nullable::4 <
:::< =
true::> B
)::B C
,::C D
Url;; 
=;; 
table;; 
.;;  
Column;;  &
<;;& '
string;;' -
>;;- .
(;;. /
nullable;;/ 7
:;;7 8
true;;9 =
);;= >
,;;> ?
UserId<< 
=<< 
table<< "
.<<" #
Column<<# )
<<<) *
int<<* -
><<- .
(<<. /
nullable<</ 7
:<<7 8
false<<9 >
)<<> ?
}== 
,== 
constraints>> 
:>> 
table>> "
=>>># %
{?? 
table@@ 
.@@ 

PrimaryKey@@ $
(@@$ %
$str@@% 0
,@@0 1
x@@2 3
=>@@4 6
x@@7 8
.@@8 9
Id@@9 ;
)@@; <
;@@< =
tableAA 
.AA 

ForeignKeyAA $
(AA$ %
nameBB 
:BB 
$strBB 6
,BB6 7
columnCC 
:CC 
xCC  !
=>CC" $
xCC% &
.CC& '
UserIdCC' -
,CC- .
principalTableDD &
:DD& '
$strDD( /
,DD/ 0
principalColumnEE '
:EE' (
$strEE) -
,EE- .
onDeleteFF  
:FF  !
ReferentialActionFF" 3
.FF3 4
CascadeFF4 ;
)FF; <
;FF< =
}GG 
)GG 
;GG 
migrationBuilderII 
.II 
CreateIndexII (
(II( )
nameJJ 
:JJ 
$strJJ (
,JJ( )
tableKK 
:KK 
$strKK 
,KK  
columnLL 
:LL 
$strLL  
)LL  !
;LL! "
}MM 	
	protectedOO 
overrideOO 
voidOO 
DownOO  $
(OO$ %
MigrationBuilderOO% 5
migrationBuilderOO6 F
)OOF G
{PP 	
migrationBuilderQQ 
.QQ 
	DropTableQQ &
(QQ& '
nameRR 
:RR 
$strRR 
)RR 
;RR  
migrationBuilderTT 
.TT 
	DropTableTT &
(TT& '
nameUU 
:UU 
$strUU 
)UU 
;UU  
migrationBuilderWW 
.WW 
	DropTableWW &
(WW& '
nameXX 
:XX 
$strXX 
)XX 
;XX 
}YY 	
}ZZ 
}[[ ˇ
SC:\Users\jonathan andujo\Documents\GitHub\mfatesttdev\DatingApp.API\Models\Photo.cs
	namespace 	
	DatingApp
 
. 
API 
. 
Models 
{ 
public 

class 
Photo 
{ 
public	 
int 
Id 
{ 
get 
; 
set !
;! "
}# $
public	 
string 
Url 
{ 
get  
;  !
set" %
;% &
}' (
public			 
string		 
Description		 "
{		# $
get		% (
;		( )
set		* -
;		- .
}		/ 0
public

	 
DateTime

 
	DateAdded

 "
{

# $
get

% (
;

( )
set

* -
;

- .
}

/ 0
public	 
bool 
IsMain 
{ 
get !
;! "
set# &
;& '
}( )
public	 
string 
PublicId 
{  !
get" %
;% &
set' *
;* +
}, -
public	 
User 
User 
{ 
get 
;  
set! $
;$ %
}& '
public	 
int 
UserId 
{ 
get  
;  !
set" %
;% &
}' (
} 
} Õ
SC:\Users\jonathan andujo\Documents\GitHub\mfatesttdev\DatingApp.API\Models\Users.cs
	namespace 	
	DatingApp
 
. 
API 
. 
Models 
{ 
public 

class 
User 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public		 
string		 
UserName		 
{		  
get		! $
;		$ %
set		& )
;		) *
}		+ ,
public

 
byte

 
[

 
]

 
PasswordHash

 "
{

# $
get

% (
;

( )
set

* -
;

- .
}

/ 0
public 
byte 
[ 
] 
PasswordSalt "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 
Gender 
{ 
get "
;" #
set$ '
;' (
}) *
public 
DateTime 
DateOfBirth #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
string 
KnownAs 
{ 
get  #
;# $
set% (
;( )
}* +
public 
DateTime 
Created 
{  !
get" %
;% &
set' *
;* +
}, -
public 
DateTime 

LastActive "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 
Introduction "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 

LookingFor  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
string 
	Interests 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
City 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
Country 
{ 
get  #
;# $
set% (
;( )
}* +
public 
ICollection 
< 
Photo  
>  !
Photos" (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
} 
} ﬁ
TC:\Users\jonathan andujo\Documents\GitHub\mfatesttdev\DatingApp.API\Models\Values.cs
	namespace 	
	DatingApp
 
. 
API 
. 
Models 
{ 
public 
class 
Value 
{ 
public 

int 
Id 
{ 
get 
; 
set 
; 
} 
public 

string 
Name 
{ 
get 
; 
set !
;! "
}# $
} 
} ˙
NC:\Users\jonathan andujo\Documents\GitHub\mfatesttdev\DatingApp.API\Program.cs
	namespace 	
	DatingApp
 
. 
API 
{ 
public 

class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	
BuildWebHost 
( 
args 
) 
. 
Run "
(" #
)# $
;$ %
} 	
public 
static 
IWebHost 
BuildWebHost +
(+ ,
string, 2
[2 3
]3 4
args5 9
)9 :
=>; =
WebHost 
.  
CreateDefaultBuilder (
(( )
args) -
)- .
. 

UseStartup 
< 
Startup #
># $
($ %
)% &
. 
Build 
( 
) 
; 
} 
} û6
NC:\Users\jonathan andujo\Documents\GitHub\mfatesttdev\DatingApp.API\Startup.cs
	namespace 	
	DatingApp
 
. 
API 
{ 
public 

class 
Startup 
{ 
public 
Startup 
( 
IConfiguration %
configuration& 3
)3 4
{ 	
Configuration 
= 
configuration )
;) *
} 	
public   
IConfiguration   
Configuration   +
{  , -
get  . 1
;  1 2
}  3 4
public## 
void## 
ConfigureServices## %
(##% &
IServiceCollection##& 8
services##9 A
)##A B
{$$ 	
services%% 
.%% 
AddDbContext%% !
<%%! "
DataContext%%" -
>%%- .
(%%. /
x%%/ 0
=>%%1 3
x%%4 5
.%%5 6
	UseSqlite%%6 ?
(%%? @
Configuration%%@ M
.%%M N
GetConnectionString%%N a
(%%a b
$str%%b u
)%%u v
)%%v w
)%%w x
;%%x y
services&& 
.&& 
AddMvc&& 
(&& 
)&& 
.&& 
AddJsonOptions&& ,
(&&, -
opt&&- 0
=>&&1 3
{&&4 5
opt'' 
.'' 
SerializerSettings'' &
.''& '!
ReferenceLoopHandling''' <
=''= >

Newtonsoft''? I
.''I J
Json''J N
.''N O!
ReferenceLoopHandling''O d
.''d e
Ignore''e k
;''k l
})) 
))) 
;)) 
services** 
.** 
AddCors** 
(** 
)** 
;** 
services++ 
.++ 
	Configure++ 
<++ 
CloudinarySettings++ 1
>++1 2
(++2 3
(++3 4
settings++4 <
)++< =
=>++> @
{,, 
Configuration-- 
.-- 

GetSection-- (
(--( )
$str--) =
)--= >
.--> ?
Bind--? C
(--C D
settings--D L
)--L M
;--M N
}.. 
).. 
;.. 
services// 
.// 
AddAutoMapper// "
(//" #
)//# $
;//$ %
services00 
.00 
AddTransient00 !
<00! "
Seed00" &
>00& '
(00' (
)00( )
;00) *
services11 
.11 
	AddScoped11 
<11 
IAuthRepository11 .
,11. /
AuthRepository110 >
>11> ?
(11? @
)11@ A
;11A B
services22 
.22 
	AddScoped22 
<22 
IDatingRepository22 0
,220 1
DatingRepository222 B
>22B C
(22C D
)22D E
;22E F
services44 
.44 
AddAuthentication44 &
(44& '
JwtBearerDefaults44' 8
.448 9 
AuthenticationScheme449 M
)44M N
.55 
AddJwtBearer55 
(55 
options55 !
=>55" $
{55% &
options66 
.66 %
TokenValidationParameters66 1
=662 3
new664 7%
TokenValidationParameters668 Q
{66Q R$
ValidateIssuerSigningKey77 -
=77. /
true770 4
,774 5
IssuerSigningKey88 %
=88& '
new88( + 
SymmetricSecurityKey88, @
(88@ A
Encoding88A I
.88I J
ASCII88J O
.99 
GetBytes99 
(99 
Configuration99 ,
.99, -

GetSection99- 7
(997 8
$str998 K
)99K L
.99L M
Value99M R
)99R S
)99S T
,99T U
ValidateIssuer:: #
=::$ %
false::& +
,::+ ,
ValidateAudience;; %
=;;& '
false;;( -
}<< 
;<< 
}== 
)== 
;== 
}>> 	
publicAA 
voidAA 
	ConfigureAA 
(AA 
IApplicationBuilderAA 1
appAA2 5
,AA5 6
IHostingEnvironmentAA7 J
envAAK N
,AAN O
SeedAAP T
seederAAU [
)AA[ \
{BB 	
ifCC 
(CC 
envCC 
.CC 
IsDevelopmentCC !
(CC! "
)CC" #
)CC# $
{DD 
appEE 
.EE %
UseDeveloperExceptionPageEE -
(EE- .
)EE. /
;EE/ 0
}FF 
elseGG 
{HH 
appII 
.II 
UseExceptionHandlerII *
(II* +
builderII+ 2
=>II3 5
{JJ 
builderKK 
.KK 
RunKK 
(KK  
asyncKK  %
contextKK& -
=>KK. 0
{LL 
contextMM 
.MM  
ResponseMM  (
.MM( )

StatusCodeMM) 3
=MM4 5
(MM6 7
intMM7 :
)MM: ;
HttpStatusCodeMM; I
.MMI J
InternalServerErrorMMJ ]
;MM] ^
varNN 
errorNN !
=NN" #
contextNN$ +
.NN+ ,
FeaturesNN, 4
.NN4 5
GetNN5 8
<NN8 9$
IExceptionHandlerFeatureNN9 Q
>NNQ R
(NNR S
)NNS T
;NNT U
ifOO 
(OO 
errorOO  
!=OO! #
nullOO$ (
)OO( )
{PP 
contextQQ #
.QQ# $
ResponseQQ$ ,
.QQ, -
AddApplicationErrorQQ- @
(QQ@ A
errorQQA F
.QQF G
ErrorQQG L
.QQL M
MessageQQM T
)QQT U
;QQU V
awaitRR !
contextRR" )
.RR) *
ResponseRR* 2
.RR2 3

WriteAsyncRR3 =
(RR= >
errorRR> C
.RRC D
ErrorRRD I
.RRI J
MessageRRJ Q
)RRQ R
;RRR S
}SS 
}TT 
)TT 
;TT 
}UU 
)UU 
;UU 
}VV 
appYY 
.YY 
UseCorsYY 
(YY 
xYY 
=>YY 
xYY 
.YY 
WithOriginsYY *
(YY* +
$strYY+ B
)YYB C
.ZZ 
AllowAnyHeaderZZ 
(ZZ  
)ZZ  !
.ZZ! "
AllowAnyMethodZZ" 0
(ZZ0 1
)ZZ1 2
.ZZ2 3
AllowCredentialsZZ3 C
(ZZC D
)ZZD E
)ZZE F
;ZZF G
app[[ 
.[[ 
UseAuthentication[[ !
([[! "
)[[" #
;[[# $
app\\ 
.\\ 
UseMvc\\ 
(\\ 
)\\ 
;\\ 
}]] 	
}^^ 
}__ 